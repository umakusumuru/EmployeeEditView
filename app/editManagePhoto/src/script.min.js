/*
 kaakateeyaangularapplication 2017-03-15 
*/
!function(angular){"use strict";function controller(editManagePhotoModel,scope){var vm=this;vm.init=function(){vm.model=editManagePhotoModel,vm.model.scope=scope},vm.init()}angular.module("KaakateeyaEmpEdit").controller("editManagePhotoCtrl",controller),controller.$inject=["editManagePhotoModel","$scope"]}(angular),function(angular){"use strict";function factory(editManagePhotoService,authSvc,alertss,commonFactory,uibModal,http,fileUpload){var model={};model.scope={};var logincustid=authSvc.getCustId(),CustID=void 0!==logincustid&&null!==logincustid&&""!==logincustid?logincustid:null;model.loginpaidstatus=authSvc.getpaidstatus();var genderID=authSvc.getGenderID();return model.photorowID=0,model.init=function(){return model.getData(),model},model.getData=function(){editManagePhotoService.getPhotoData(CustID).then(function(response){console.log(response.data),model.manageArr=response.data,model.refreshPageLoad(model.manageArr)})},model.refreshPageLoad=function(Arr){return _.each(Arr,function(item){model.rbtProtectPassword="Admin@123"===item.PhotoPassword?"1":"0";var imagepath=editviewapp.accesspathdots;if(0===item.IsActive&&null!==item.PhotoName){var strCustDirName1="KMPL_"+CustID+"_Images",path1=imagepath+strCustDirName1+"/"+item.PhotoName;item.ImageUrl=path1+"?decache="+Math.random(),item.addButtonvisible=!1,item.keyname=strCustDirName1+"/"+item.PhotoName}else if(1===item.IsActive&&1===item.IsThumbNailCreated){var strCustDirName="KMPL_"+CustID+"_Images";switch(item.addButtonvisible=!1,item.DisplayOrder){case 1:var photoshoppath="Img1_Images/"+item.ProfileID+"_ApplicationPhoto.jpg",path11=imagepath+strCustDirName+"/"+photoshoppath;item.ImageUrl=path11,item.keyname=strCustDirName+"/"+photoshoppath;break;case 2:var photoshoppathnew="Img2_Images/"+item.ProfileID+"_ApplicationPhoto.jpg",pathnew=imagepath+strCustDirName+"/"+photoshoppathnew;item.ImageUrl=pathnew,item.keyname=strCustDirName+"/"+photoshoppathnew;break;case 3:var photoshoppathneew3="Img3_Images/"+item.ProfileID+"_ApplicationPhoto.jpg",pathneww=imagepath+strCustDirName+"/"+photoshoppathneew3;item.ImageUrl=pathneww,item.keyname=strCustDirName+"/"+photoshoppathneew3}}else 0===item.IsActive&&null===item.PhotoName&&(item.addButtonvisible=!0,item.ImageUrl="1"===genderID||1===genderID?editviewapp.Mnoimage:editviewapp.Fnoimage)}),Arr},model.cancel=function(){commonFactory.closepopup()},model.AddImage=function(index,Cust_Photos_ID,DisplayOrder,IsActive){model.photorowID=index,model.Cust_Photos_ID=Cust_Photos_ID,model.DisplayOrder=DisplayOrder,model.IsActive=IsActive,commonFactory.open("AddimagePopup.html",model.scope,uibModal,"sm")},model.upload=function(obj){console.log(obj.myFile);var extension=""!==obj.myFile.name&&void 0!==obj.myFile.name&&null!==obj.myFile.name?obj.myFile.name.split(".")[1]:null;if(extension=angular.lowercase(extension),void 0!==obj.myFile.name){var size=parseFloat(obj.myFile.size/1024).toFixed(2);if(null!==extension&&"gif, jpeg, png,jpg".indexOf(angular.lowercase(extension))===-1)alert("Your uploaded image contains an unapproved file formats.");else if(size>4096)alert("Sorry,Upload Photo Size Must Be Less than 1 mb");else{var keyname=editviewapp.prefixPath+"KMPL_"+CustID+"_Images/Img"+model.photorowID+"."+extension;fileUpload.uploadFileToUrl(obj.myFile,"/photoUplad",keyname).then(function(res){console.log(res.status),200==res.status&&(commonFactory.closepopup(),model.uploadData={GetDetails:{ID:model.Cust_Photos_ID,url:"Img"+model.photorowID+"."+extension,order:model.DisplayOrder,IsProfilePic:0,DisplayStatus:model.DisplayOrder,Password:0,IsReviewed:0,TempImageUrl:editviewapp.GlobalImgPath+keyname,IsTempActive:commonFactory.checkvals(model.IsActive)?model.IsActive:"0",DeletedImageurl:null,IsImageDeleted:0,PhotoStatus:null,PhotoID:model.DisplayOrder,PhotoPassword:null},customerpersonaldetails:{intCusID:CustID,EmpID:null,Admin:null}},editManagePhotoService.submituploadData(model.uploadData).then(function(response){console.log(response),200===response.status?(model.manageArr=response.data,model.refreshPageLoad(model.manageArr),alertss.timeoutoldalerts(model.scope,"alert-success","submitted Succesfully",4500)):alertss.timeoutoldalerts(model.scope,"alert-success","Updation failed",4500)}))})}}else alert("This browser does not support HTML5.")},model.DeleteImage=function(key,Cust_Photoid){model.deleteKey=key,model.DCust_Photos_ID=Cust_Photoid,commonFactory.open("deleteimagePopup.html",model.scope,uibModal,"sm")},model.Delete=function(){var keynameq=editviewapp.prefixPath+model.deleteKey;http.post("/photoDelete",JSON.stringify({keyname:keynameq})).then(function(data){}),editManagePhotoService.linqSubmits(model.DCust_Photos_ID,3).then(function(response){1===response.data&&(commonFactory.closepopup(),model.getData())})},model.setAsProfilePic=function(cust_photoID){editManagePhotoService.linqSubmits(cust_photoID,2).then(function(response){console.log(response.data),1===response.data&&model.getData()})},model.setPhotoPassword=function(obj){editManagePhotoService.linqSubmits(CustID,obj).then(function(response){console.log(response),1===response.data&&("1"===obj?alert("Protect with Password  Uploaded Successfully"):alert("Protect with Password Removed Successfully"))})},model.redirectPage=function(type){switch(type){case"PhotoGuideLines":window.open("#/registration/photoGuideLines","_blank");break;case"Faqs":window.open("#/faqs","_blank");break;case"uploadTips":window.open("#/registration/uploadTips","_blank")}},model.init()}angular.module("KaakateeyaEmpEdit").factory("editManagePhotoModel",factory),factory.$inject=["editManagePhotoService","authSvc","alert","commonFactory","$uibModal","$http","fileUpload"]}(angular),function(angular){"use strict";function factory(http){return{getPhotoData:function(obj){return http.get(editviewapp.apipath+"CustomerPersonal/GetphotosofCustomer",{params:{Custid:obj,EmpID:2}})},submituploadData:function(obj1){return http.post(editviewapp.apipath+"CustomerPersonalUpdate/Savephotosofcustomer",JSON.stringify(obj1))},linqSubmits:function(Custid,iflag){return http.get(editviewapp.apipath+"CustomerPersonalUpdate/getPhotoPassword",{params:{CustID:Custid,ipassword:iflag}})}}}angular.module("KaakateeyaEmpEdit").factory("editManagePhotoService",factory),factory.$inject=["$http"]}(angular);