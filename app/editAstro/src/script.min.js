/*
 kaakateeyaangularapplication 2017-03-15 
*/
!function(angular){"use strict";function controller(editAstroModel,scope){var vm=this;vm.scope=scope,vm.init=function(){vm.model=editAstroModel,vm.model.scope=scope},vm.init()}angular.module("KaakateeyaEmpEdit").controller("editAstroCtrl",controller),controller.$inject=["editAstroModel","$scope"]}(angular),function(angular){"use strict";function factory(editAstroService,authSvc,alertss,commonFactory,uibModal,fileUpload,http){var model={};model.scope={},model.atroObj=[],model.generateData=[],model.ImageUrl="",model.iframeShow=!1;var s3obj={},logincustid=authSvc.getCustId(),custID=model.CustID=void 0!==logincustid&&null!==logincustid&&""!==logincustid?logincustid:null,isSubmit=!0;return model.loginpaidstatus=authSvc.getpaidstatus(),model.init=function(){return model.astropageload(),model},model.astropageload=function(){editAstroService.getAstroData(custID).then(function(response){if(commonFactory.checkvals(response.data[0]))if(model.AstroArr=JSON.parse(response.data[0]),model.generateData=JSON.parse(response.data[1]),commonFactory.checkvals(model.AstroArr[0]&&commonFactory.checkvals(model.AstroArr[0].Horoscopeimage))){if(commonFactory.checkvals(model.AstroArr[0].Horoscopeimage)&&model.AstroArr[0].Horoscopeimage.indexOf("Horo_no")===-1){var extension="jpg";model.AstroArr[0].Horoscopeimage.indexOf(".html")!==-1?extension="html":(model.iframeShow=!1,extension="jpg"),model.ImageUrl=editviewapp.GlobalImgPathforimage+"Images/Horoscopeimages/"+custID+"_HaromodelImage/"+custID+"_HaromodelImage."+extension,"html"===extension&&(model.iframeShow=!0,$("#iframe").attr("src",model.ImageUrl))}}else if(commonFactory.checkvals(model.generateData[0].Horoscopeimage)&&model.generateData[0].Horoscopeimage.indexOf("Horo_no")===-1&&commonFactory.checkvals(model.generateData[0].Horoscopeimage)&&model.generateData[0].Horoscopeimage.indexOf("Horo_no")===-1){var extensn="jpg";model.generateData[0].Horoscopeimage.indexOf(".html")!==-1?extensn="html":(model.iframeShow=!1,extensn="jpg"),model.ImageUrl=editviewapp.GlobalImgPathforimage+"Images/Horoscopeimages/"+custID+"_HaromodelImage/"+custID+"_HaromodelImage."+extensn,"html"===extensn&&(model.iframeShow=!0,$("#iframe").attr("src",model.ImageUrl))}})},model.populateAstro=function(item){model.hrsbindArr=commonFactory.numberBindWithZeros("Hours",0,23),model.minbindArr=commonFactory.numberBindWithZeros("Minutes",0,59),model.secbindArr=commonFactory.numberBindWithZeros("Seconds",0,59),isSubmit=!0,void 0!==item&&(model.starArr=commonFactory.starBind(item.StarLanguageID),void 0!==item.TimeOfBirth&&(model.strdot=item.TimeOfBirth.split(" ")[0].split(":"),model.atroObj.ddlFromHours=parseInt(model.strdot[0]),model.atroObj.ddlFromMinutes=parseInt(model.strdot[1]),model.atroObj.ddlFromSeconds=parseInt(model.strdot[2])),model.atroObj.ddlCountryOfBirthID=item.CountryOfBirthID,model.atroObj.ddlStateOfBirthID=item.StateOfBirthID,model.atroObj.ddlDistrictOfBirthID=item.DistrictOfBirthID,model.atroObj.ddlcity=item.CityOfBirthID,model.atroObj.ddlstarlanguage=item.StarLanguageID,model.atroObj.ddlstar=item.StarID,model.atroObj.ddlpaadam=item.PaadamID,model.atroObj.ddlLagnam=item.LagnamID,model.atroObj.ddlRaasiMoonsign=item.RaasiID,model.atroObj.txtGothramGotra=item.Gothram,model.atroObj.txtMaternalgothram=item.MeternalGothramID,model.atroObj.rdlkujaDosham=item.manglikID),commonFactory.open("astroContent.html",model.scope,uibModal)},model.changeBind=function(type,parentval){switch(type){case"star":model.starArr=commonFactory.starBind(parentval)}},model.astroSubmit=function(obj){if(isSubmit){isSubmit=!1,$("#ssss").prop("disabled",!0);var strFromTimeOfBirth=obj.ddlFromHours+":"+obj.ddlFromMinutes+":"+obj.ddlFromSeconds;model.astroData={GetDetails:{CustID:custID,TimeofBirth:strFromTimeOfBirth,CountryOfBirthID:obj.ddlCountryOfBirthID,StateOfBirthID:obj.ddlStateOfBirthID,DistrictOfBirthID:obj.ddlDistrictOfBirthID,CityOfBirthID:obj.ddlcity,Starlanguage:obj.ddlstarlanguage,Star:obj.ddlstar,Paadam:obj.ddlpaadam,Lagnam:obj.ddlLagnam,RasiMoonsign:obj.ddlRaasiMoonsign,GothramGotra:obj.txtGothramGotra,Maternalgothram:obj.txtMaternalgothram,ManglikKujadosham:obj.rdlkujaDosham,Pblongitude:obj.PBlongitude,pblatitude:obj.PBlatitude,TimeZone:null},customerpersonaldetails:{intCusID:custID,EmpID:null,Admin:null}},model.submitPromise=editAstroService.submitAstroData(model.astroData).then(function(response){commonFactory.closepopup(),1===response.data?(1===model.datagetInStatus&&(sessionStorage.removeItem("missingStatus"),route.go("mobileverf",{})),model.astropageload(custID),alertss.timeoutoldalerts(model.scope,"alert-success","submitted Succesfully",4500)):alertss.timeoutoldalerts(model.scope,"alert-danger","Updation failed",4500)})}},model.cancel=function(){commonFactory.closepopup()},model.uploadGenerateHoro=function(val){"0"===val?commonFactory.open("AddHoroPopup.html",model.scope,uibModal,"sm"):model.AstroArr.length>0?model.generateHoro():model.populateAstro()},model.upload=function(obj){var extension=""!==obj.myFile.name&&void 0!==obj.myFile.name&&null!==obj.myFile.name?obj.myFile.name.split(".")[1]:null;if(void 0!==obj.myFile.name){var size=parseFloat(obj.myFile.size/1024).toFixed(2);if(null!==extension&&"gif, jpeg, png,jpg".indexOf(angular.lowercase(extension))===-1)alert("Your uploaded image contains an unapproved file formats.");else if(size>4096)alert("Sorry,Upload Photo Size Must Be Less than 1 mb");else{var keyname="Images/Horoscopeimages/"+custID+"_HaromodelImage/"+custID+"_HaromodelImage."+extension;fileUpload.uploadFileToUrl(obj.myFile,"/photoUplad",keyname).then(function(res){200==res.status&&(commonFactory.closepopup(),model.uploadData={Cust_ID:custID,Horopath:"../../"+keyname,ModifiedByEmpID:"",VisibleToID:keyname.indexOf("html")!==-1?1:"",Empid:"",IsActive:keyname.indexOf("html")!==-1?1:0,i_flag:1},editAstroService.uploadDeleteAstroData(model.uploadData).then(function(response){commonFactory.closepopup(),model.astropageload(custID),model.ImageUrl=editviewapp.GlobalImgPathforimage+"Images/Horoscopeimages/"+custID+"_HaromodelImage/"+custID+"_HaromodelImage."+extension}))})}}else alert("This browser does not support HTML5.")},model.generateHoro=function(astrocity){var check=moment(model.generateData[0].DateOfBirth,"YYYY/MM/DD"),month=check.format("M"),day=check.format("D"),year=check.format("YYYY"),inputobj={customerid:custID,EmpIDQueryString:"2",intDay:day,intMonth:month,intYear:year,CityID:commonFactory.checkvals(astrocity)?astrocity:""};editAstroService.generateHoroscope(inputobj).then(function(response){console.log(response),commonFactory.checkvals(response.data.AstroGeneration)?(s3obj={Path:response.data.Path,KeyName:response.data.KeyName},window.open(""+response.data.AstroGeneration,"_blank"),commonFactory.closepopup(),commonFactory.open("RefreshPopup.html",model.scope,uibModal)):(model.AstrocityArr=commonFactory.AstroCity(model.AstroArr[0].CountryOfBirth,model.AstroArr[0].StateOfBirth),commonFactory.open("AstroCityPopup.html",model.scope,uibModal))})},model.deleteHoroImage=function(){var keynameq="Images/Horoscopeimages/"+custID+"_HaromodelImage/"+custID+"_HaromodelImage.jpg";http.post("/photoDelete",JSON.stringify({keyname:keynameq})).then(function(data){}),model.uploadData={Cust_ID:custID,i_flag:0},editAstroService.uploadDeleteAstroData(model.uploadData).then(function(response){1!==response.data&&"1"!==response.data||(model.astropageload(custID),commonFactory.closepopup(),model.ImageUrl="",model.atroObj.rdlUploadGenerate="")})},model.shoedeletePopup=function(){commonFactory.open("deletehoroPopup.html",model.scope,uibModal,"sm")},model.AstroCityChange=function(val){model.generateHoro(val)},model.vewHoro=function(){null!==model.ImageUrl&&""!==model.ImageUrl&&void 0!==model.ImageUrl&&(model.ImageUrl.indexOf(".html")!==-1?window.open(""+model.ImageUrl,"_blank"):commonFactory.open("AstroimagePopup.html",model.scope,uibModal))},model.generatedhoroS3Upload=function(){console.log("s3obj"),console.log(s3obj),editAstroService.GenerateHoroS3(s3obj).then(function(response){console.log(response)}),model.astropageload(custID),commonFactory.closepopup()},model.init()}angular.module("KaakateeyaEmpEdit").factory("editAstroModel",factory),factory.$inject=["editAstroService","authSvc","alert","commonFactory","$uibModal","fileUpload","$http"]}(angular),function(angular){"use strict";function factory(http){return{getAstroData:function(obj){return http.get(editviewapp.apipath+"CustomerPersonal/getAstroDetailsDisplay",{params:{CustID:obj}})},submitAstroData:function(obj1){return http.post(editviewapp.apipath+"CustomerPersonalUpdate/CustomerAstrodetailsUpdatedetails",JSON.stringify(obj1))},uploadDeleteAstroData:function(obj1){return http.post(editviewapp.apipath+"CustomerPersonalUpdate/AstroDetailsUpdateDelete",JSON.stringify(obj1))},generateHoroscope:function(obj){return http.get(editviewapp.apipath+"CustomerPersonalUpdate/getGenerateHoroscorpe",{params:{customerid:obj.customerid,EmpIDQueryString:obj.EmpIDQueryString,intDay:obj.intDay,intMonth:obj.intMonth,intYear:obj.intYear,CityID:obj.CityID}})},GenerateHoroS3:function(obj){return http.get(editviewapp.apipath+"CustomerPersonalUpdate/getAstroGenerationS3Update",{params:{Path:JSON.stringify(obj.Path),KeyName:JSON.stringify(obj.KeyName)}})}}}angular.module("KaakateeyaEmpEdit").factory("editAstroService",factory),factory.$inject=["$http"]}(angular),function(angular){"use strict";function controller(editAstroModel,scope){var vm=this;vm.scope=scope,vm.init=function(){vm.model=editAstroModel,vm.model.scope=scope},vm.init()}angular.module("KaakateeyaEmpEdit").controller("editAstroCtrl",controller),controller.$inject=["editAstroModel","$scope"]}(angular),function(angular){"use strict";function factory(editAstroService,authSvc,alertss,commonFactory,uibModal,fileUpload,http){var model={};model.scope={},model.atroObj=[],model.generateData=[],model.ImageUrl="",model.iframeShow=!1;var s3obj={},logincustid=authSvc.getCustId(),custID=model.CustID=void 0!==logincustid&&null!==logincustid&&""!==logincustid?logincustid:null,isSubmit=!0;return model.loginpaidstatus=authSvc.getpaidstatus(),model.init=function(){return model.astropageload(),model},model.astropageload=function(){editAstroService.getAstroData(custID).then(function(response){if(commonFactory.checkvals(response.data[0]))if(model.AstroArr=JSON.parse(response.data[0]),model.generateData=JSON.parse(response.data[1]),commonFactory.checkvals(model.AstroArr[0]&&commonFactory.checkvals(model.AstroArr[0].Horoscopeimage))){if(commonFactory.checkvals(model.AstroArr[0].Horoscopeimage)&&model.AstroArr[0].Horoscopeimage.indexOf("Horo_no")===-1){var extension="jpg";model.AstroArr[0].Horoscopeimage.indexOf(".html")!==-1?extension="html":(model.iframeShow=!1,extension="jpg"),model.ImageUrl=editviewapp.GlobalImgPathforimage+"Images/Horoscopeimages/"+custID+"_HaromodelImage/"+custID+"_HaromodelImage."+extension,"html"===extension&&(model.iframeShow=!0,$("#iframe").attr("src",model.ImageUrl))}}else if(commonFactory.checkvals(model.generateData[0].Horoscopeimage)&&model.generateData[0].Horoscopeimage.indexOf("Horo_no")===-1&&commonFactory.checkvals(model.generateData[0].Horoscopeimage)&&model.generateData[0].Horoscopeimage.indexOf("Horo_no")===-1){var extensn="jpg";model.generateData[0].Horoscopeimage.indexOf(".html")!==-1?extensn="html":(model.iframeShow=!1,extensn="jpg"),model.ImageUrl=editviewapp.GlobalImgPathforimage+"Images/Horoscopeimages/"+custID+"_HaromodelImage/"+custID+"_HaromodelImage."+extensn,"html"===extensn&&(model.iframeShow=!0,$("#iframe").attr("src",model.ImageUrl))}})},model.populateAstro=function(item){model.hrsbindArr=commonFactory.numberBindWithZeros("Hours",0,23),model.minbindArr=commonFactory.numberBindWithZeros("Minutes",0,59),model.secbindArr=commonFactory.numberBindWithZeros("Seconds",0,59),isSubmit=!0,void 0!==item&&(model.starArr=commonFactory.starBind(item.StarLanguageID),void 0!==item.TimeOfBirth&&(model.strdot=item.TimeOfBirth.split(" ")[0].split(":"),model.atroObj.ddlFromHours=parseInt(model.strdot[0]),model.atroObj.ddlFromMinutes=parseInt(model.strdot[1]),model.atroObj.ddlFromSeconds=parseInt(model.strdot[2])),model.atroObj.ddlCountryOfBirthID=item.CountryOfBirthID,model.atroObj.ddlStateOfBirthID=item.StateOfBirthID,model.atroObj.ddlDistrictOfBirthID=item.DistrictOfBirthID,model.atroObj.ddlcity=item.CityOfBirthID,model.atroObj.ddlstarlanguage=item.StarLanguageID,model.atroObj.ddlstar=item.StarID,model.atroObj.ddlpaadam=item.PaadamID,model.atroObj.ddlLagnam=item.LagnamID,model.atroObj.ddlRaasiMoonsign=item.RaasiID,model.atroObj.txtGothramGotra=item.Gothram,model.atroObj.txtMaternalgothram=item.MeternalGothramID,model.atroObj.rdlkujaDosham=item.manglikID),commonFactory.open("astroContent.html",model.scope,uibModal)},model.changeBind=function(type,parentval){switch(type){case"star":model.starArr=commonFactory.starBind(parentval)}},model.astroSubmit=function(obj){if(isSubmit){isSubmit=!1,$("#ssss").prop("disabled",!0);var strFromTimeOfBirth=obj.ddlFromHours+":"+obj.ddlFromMinutes+":"+obj.ddlFromSeconds;model.astroData={GetDetails:{CustID:custID,TimeofBirth:strFromTimeOfBirth,CountryOfBirthID:obj.ddlCountryOfBirthID,StateOfBirthID:obj.ddlStateOfBirthID,DistrictOfBirthID:obj.ddlDistrictOfBirthID,CityOfBirthID:obj.ddlcity,Starlanguage:obj.ddlstarlanguage,Star:obj.ddlstar,Paadam:obj.ddlpaadam,Lagnam:obj.ddlLagnam,RasiMoonsign:obj.ddlRaasiMoonsign,GothramGotra:obj.txtGothramGotra,Maternalgothram:obj.txtMaternalgothram,ManglikKujadosham:obj.rdlkujaDosham,Pblongitude:obj.PBlongitude,pblatitude:obj.PBlatitude,TimeZone:null},customerpersonaldetails:{intCusID:custID,EmpID:null,Admin:null}},model.submitPromise=editAstroService.submitAstroData(model.astroData).then(function(response){commonFactory.closepopup(),1===response.data?(1===model.datagetInStatus&&(sessionStorage.removeItem("missingStatus"),route.go("mobileverf",{})),model.astropageload(custID),alertss.timeoutoldalerts(model.scope,"alert-success","submitted Succesfully",4500)):alertss.timeoutoldalerts(model.scope,"alert-danger","Updation failed",4500)})}},model.cancel=function(){commonFactory.closepopup()},model.uploadGenerateHoro=function(val){"0"===val?commonFactory.open("AddHoroPopup.html",model.scope,uibModal,"sm"):model.AstroArr.length>0?model.generateHoro():model.populateAstro()},model.upload=function(obj){var extension=""!==obj.myFile.name&&void 0!==obj.myFile.name&&null!==obj.myFile.name?obj.myFile.name.split(".")[1]:null;if(void 0!==obj.myFile.name){var size=parseFloat(obj.myFile.size/1024).toFixed(2);if(null!==extension&&"gif, jpeg, png,jpg".indexOf(angular.lowercase(extension))===-1)alert("Your uploaded image contains an unapproved file formats.");else if(size>4096)alert("Sorry,Upload Photo Size Must Be Less than 1 mb");else{var keyname="Images/Horoscopeimages/"+custID+"_HaromodelImage/"+custID+"_HaromodelImage."+extension;fileUpload.uploadFileToUrl(obj.myFile,"/photoUplad",keyname).then(function(res){200==res.status&&(commonFactory.closepopup(),model.uploadData={Cust_ID:custID,Horopath:"../../"+keyname,ModifiedByEmpID:"",VisibleToID:keyname.indexOf("html")!==-1?1:"",Empid:"",IsActive:keyname.indexOf("html")!==-1?1:0,i_flag:1},editAstroService.uploadDeleteAstroData(model.uploadData).then(function(response){commonFactory.closepopup(),model.astropageload(custID),model.ImageUrl=editviewapp.GlobalImgPathforimage+"Images/Horoscopeimages/"+custID+"_HaromodelImage/"+custID+"_HaromodelImage."+extension}))})}}else alert("This browser does not support HTML5.")},model.generateHoro=function(astrocity){var check=moment(model.generateData[0].DateOfBirth,"YYYY/MM/DD"),month=check.format("M"),day=check.format("D"),year=check.format("YYYY"),inputobj={customerid:custID,EmpIDQueryString:"2",intDay:day,intMonth:month,intYear:year,CityID:commonFactory.checkvals(astrocity)?astrocity:""};editAstroService.generateHoroscope(inputobj).then(function(response){console.log(response),commonFactory.checkvals(response.data.AstroGeneration)?(s3obj={Path:response.data.Path,KeyName:response.data.KeyName},window.open(""+response.data.AstroGeneration,"_blank"),commonFactory.closepopup(),commonFactory.open("RefreshPopup.html",model.scope,uibModal)):(model.AstrocityArr=commonFactory.AstroCity(model.AstroArr[0].CountryOfBirth,model.AstroArr[0].StateOfBirth),commonFactory.open("AstroCityPopup.html",model.scope,uibModal))})},model.deleteHoroImage=function(){var keynameq="Images/Horoscopeimages/"+custID+"_HaromodelImage/"+custID+"_HaromodelImage.jpg";http.post("/photoDelete",JSON.stringify({keyname:keynameq})).then(function(data){}),model.uploadData={Cust_ID:custID,i_flag:0},editAstroService.uploadDeleteAstroData(model.uploadData).then(function(response){1!==response.data&&"1"!==response.data||(model.astropageload(custID),commonFactory.closepopup(),model.ImageUrl="",model.atroObj.rdlUploadGenerate="")})},model.shoedeletePopup=function(){commonFactory.open("deletehoroPopup.html",model.scope,uibModal,"sm")},model.AstroCityChange=function(val){model.generateHoro(val)},model.vewHoro=function(){null!==model.ImageUrl&&""!==model.ImageUrl&&void 0!==model.ImageUrl&&(model.ImageUrl.indexOf(".html")!==-1?window.open(""+model.ImageUrl,"_blank"):commonFactory.open("AstroimagePopup.html",model.scope,uibModal))},model.generatedhoroS3Upload=function(){console.log("s3obj"),console.log(s3obj),editAstroService.GenerateHoroS3(s3obj).then(function(response){console.log(response)}),model.astropageload(custID),commonFactory.closepopup()},model.init()}angular.module("KaakateeyaEmpEdit").factory("editAstroModel",factory),factory.$inject=["editAstroService","authSvc","alert","commonFactory","$uibModal","fileUpload","$http"]}(angular),function(angular){"use strict";function factory(http){return{getAstroData:function(obj){return http.get(editviewapp.apipath+"CustomerPersonal/getAstroDetailsDisplay",{params:{CustID:obj}})},submitAstroData:function(obj1){return http.post(editviewapp.apipath+"CustomerPersonalUpdate/CustomerAstrodetailsUpdatedetails",JSON.stringify(obj1))},uploadDeleteAstroData:function(obj1){return http.post(editviewapp.apipath+"CustomerPersonalUpdate/AstroDetailsUpdateDelete",JSON.stringify(obj1))},generateHoroscope:function(obj){return http.get(editviewapp.apipath+"CustomerPersonalUpdate/getGenerateHoroscorpe",{params:{customerid:obj.customerid,EmpIDQueryString:obj.EmpIDQueryString,intDay:obj.intDay,intMonth:obj.intMonth,intYear:obj.intYear,CityID:obj.CityID}})},GenerateHoroS3:function(obj){return http.get(editviewapp.apipath+"CustomerPersonalUpdate/getAstroGenerationS3Update",{params:{Path:JSON.stringify(obj.Path),KeyName:JSON.stringify(obj.KeyName)}})}}}angular.module("KaakateeyaEmpEdit").factory("editAstroService",factory),factory.$inject=["$http"]}(angular);